<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Holy Cross Button</title>
  <style>
    :root {
      --bg-color: #fff;
      --text-color: #333;
      --button-bg: linear-gradient(135deg, #f0f0f0, #d9d9d9);
      --button-hover: linear-gradient(135deg, #e6e6e6, #cccccc);
      --cross-color: #333;
      --cross-hover: #007bff;
    }
    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --text-color: #f0f0f0;
      --button-bg: linear-gradient(135deg, #2a2a2a, #1a1a1a);
      --button-hover: linear-gradient(135deg, #333, #222);
      --cross-color: #ddd;
      --cross-hover: #4da6ff;
    }
    
    body {
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.5s, color 0.5s;
    }
    
    .cross-button-container {
      text-align: center;
      margin: 20px;
    }
    .cross-button {
      position: relative;
      width: 60px;
      height: 60px;
      background: var(--button-bg);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
    }
    .cross-button:active {
      transform: scale(0.95);
    }
    .cross-vertical, .cross-horizontal {
      position: absolute;
      background: var(--cross-color);
      border-radius: 4px;
      transition: all 0.5s ease-out;
    }
    .cross-vertical {
      top: 15px;
      left: 50%;
      width: 12px;
      height: 30px;
      transform: translateX(-50%);
    }
    .cross-horizontal {
      top: 50%;
      left: 15px;
      width: 30px;
      height: 12px;
      transform: translateY(-50%);
    }
    .cross-button:hover {
      background: var(--button-hover);
    }
    .cross-button:hover .cross-vertical,
    .cross-button:hover .cross-horizontal {
      background: var(--cross-hover);
    }
    .cross-button.active {
      animation: warmGlow 4s ease-in-out;
    }
    @keyframes warmGlow {
      0% { box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700; }
      25% { box-shadow: 0 0 10px #FFA500, 0 0 20px #FFA500; }
      50% { box-shadow: 0 0 10px #FF6347, 0 0 20px #FF6347; }
      75% { box-shadow: 0 0 10px #FF4500, 0 0 20px #FF4500; }
      100% { box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); }
    }
    
    #passageOutput {
      margin: 20px;
      font-style: italic;
      color: var(--text-color);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      min-height: 100px;
    }
    
    #audioPlayer {
      margin: 10px;
    }
    
    #shareButtons a, 
    #shareButtons button,
    #favoriteButton button {
      padding: 8px 12px;
      background: var(--button-bg);
      color: var(--text-color);
      border-radius: 4px;
      margin: 5px;
      display: inline-block;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    #favoriteButton button {
      background: #ffcccb;
    }
    
    #controls {
      margin-top: 20px;
    }
    
    #analytics-consent {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-color);
      padding: 1rem;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      text-align: center;
      z-index: 1000;
    }
    
    .divine-light {
      position: absolute;
      width: 100%;
      height: 2px;
      background: radial-gradient(#ff0, transparent);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="cross-button-container">
    <button id="crossButton" class="cross-button" aria-label="Generate a new inspirational quote">
      <span class="cross-vertical"></span>
      <span class="cross-horizontal"></span>
    </button>
    <div id="passageOutput" aria-live="polite"></div>
    <div id="audioPlayer"></div>
    <div id="shareButtons"></div>
    <div id="favoriteButton"></div>
    <div id="controls">
      <button id="themeToggle">ðŸŒ“ Toggle Theme</button>
      <button id="dailyQuoteBtn">ðŸ“… Daily Quote</button>
    </div>
  </div>
  <div id="credit">Quotes sourced from multiple spiritual traditions and APIs</div>

  <div id="analytics-consent" style="display:none;">
    <p>Help spread wisdom anonymously? 
      <button id="accept-analytics">Accept</button>
      <button id="decline-analytics">Decline</button>
    </p>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
  <script>
    // Enhanced passages array with categories
    let passages = [
      // Original passages with categories added...
      { text: "There is no such thing as 'wrong,' only what does not serve you...", id: 1, source: "Conversations with God", category: "new-age" },
      // ... (rest of your original passages with added categories)
    ];

    // Spiritual APIs configuration
    const spiritualAPIs = [
      {
        name: "Bible",
        url: "https://bible-api.com/?random=true",
        parser: (data) => ({ 
          text: `${data.text} (${data.reference})`, 
          source: "Bible",
          category: "christian" 
        })
      },
      {
        name: "Quran",
        url: "https://api.alquran.cloud/v1/ayah/random/en.sahih",
        parser: (data) => ({ 
          text: data.data.text, 
          source: "Quran",
          category: "islam" 
        })
      },
      {
        name: "TaoTeChing",
        url: "https://api.ttc.rest/v1/random",
        parser: (data) => ({ 
          text: data.text, 
          source: "Tao Te Ching",
          category: "taoism" 
        })
      }
    ];

    // Spiritual calendars
    const spiritualCalendars = {
      christian: {
        sources: ["Bible", "Augustine", "Teresa of Avila"],
        color: "#3498db"
      },
      buddhist: {
        sources: ["Dhammapada", "Thich Nhat Hanh", "Pali Canon"],
        color: "#f1c40f"
      },
      // Add more traditions...
    };

    // Track usage
    let usedPassages = JSON.parse(localStorage.getItem('usedPassages')) || [];
    let favoritePassages = JSON.parse(localStorage.getItem('favoritePassages')) || [];
    let isGenerating = false;
    let voicesLoaded = false;
    let currentPassage = null;
    let currentTheme = localStorage.getItem('theme') || 'light';

    // Initialize
    document.documentElement.setAttribute('data-theme', currentTheme);
    if (localStorage.getItem('analyticsConsent') === null) {
      document.getElementById('analytics-consent').style.display = 'block';
    }

    // Sacred Geometry Animations
    const sacredGeometry = {
      animateCross: () => {
        const tl = gsap.timeline();
        tl.to(".cross-vertical", { 
          scaleY: 1.5,
          duration: 0.3,
          transformOrigin: "center center"
        })
        .to(".cross-horizontal", {
          scaleX: 1.5,
          duration: 0.3,
          transformOrigin: "center center" 
        }, "<")
        .to(".cross-button", {
          rotation: 360,
          duration: 1.5,
          ease: "power2.out"
        });
      },
      
      quoteEntrance: (element) => {
        const light = document.createElement('div');
        light.className = 'divine-light';
        element.parentNode.appendChild(light);
        
        gsap.from(element, {
          opacity: 0,
          y: 50,
          duration: 1,
          ease: "back.out",
          onComplete: () => light.remove()
        });
        
        gsap.to(light, { 
          y: element.offsetHeight,
          opacity: 0,
          duration: 1
        });
      }
    };

    // Fetch from spiritual APIs
    async function fetchSpiritualQuote() {
      try {
        const api = spiritualAPIs[Math.floor(Math.random() * spiritualAPIs.length)];
        const response = await fetch(api.url);
        const data = await response.json();
        return api.parser(data);
      } catch (error) {
        console.error("Failed to fetch:", error);
        return null;
      }
    }

    // Daily spiritual quote
    function getDailySpiritualQuote() {
      const today = new Date();
      const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
      const tradition = Object.keys(spiritualCalendars)[dayOfYear % Object.keys(spiritualCalendars).length];
      const sources = spiritualCalendars[tradition].sources;
      
      const tradQuotes = passages.filter(p => sources.includes(p.source));
      return tradQuotes[dayOfYear % tradQuotes.length];
    }

    // Modified generatePassage with all enhancements
    async function generatePassage(forceDaily = false) {
      if (isGenerating) return;
      isGenerating = true;
      
      sacredGeometry.animateCross();
      
      let passage;
      if (forceDaily) {
        passage = getDailySpiritualQuote();
      } else {
        // 30% chance to fetch new quote online
        const shouldFetchOnline = Math.random() > 0.7;
        if (shouldFetchOnline) {
          passage = await fetchSpiritualQuote();
          if (passage) {
            passage.id = `api-${Date.now()}`;
            passages.push(passage);
          }
        }
        
        if (!passage) {
          let available = passages.filter(p => !usedPassages.includes(p.id));
          if (available.length === 0) {
            usedPassages = [];
            available = passages;
          }
          passage = available[Math.floor(Math.random() * available.length)];
        }
      }
      
      if (!passage) {
        document.getElementById('passageOutput').innerHTML = '<p>No passages available.</p>';
        isGenerating = false;
        return;
      }
      
      usedPassages.push(passage.id);
      localStorage.setItem('usedPassages', JSON.stringify(usedPassages));
      currentPassage = passage;
      
      // Animate display
      const output = document.getElementById('passageOutput');
      output.innerHTML = `
        <p>"${passage.text}"${passage.source ? `<br><small>Source: ${passage.source}</small>` : ''}</p>
      `;
      sacredGeometry.quoteEntrance(output.querySelector('p'));
      
      generateAudio(passage.text, true);
      generateShareButtons(passage.text);
      generateFavoriteButton(passage);
      
      // Track event
      if (localStorage.getItem('analyticsConsent') === 'true') {
        spiritualInsights.track('quoteGenerated', passage.id);
      }
      
      isGenerating = false;
    }

    // Event listeners
    document.getElementById('crossButton').addEventListener('click', () => generatePassage());
    document.getElementById('dailyQuoteBtn').addEventListener('click', () => generatePassage(true));
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    document.getElementById('accept-analytics').addEventListener('click', acceptAnalytics);
    document.getElementById('decline-analytics').addEventListener('click', declineAnalytics);

    // Initialize
    updatePassages();
    if (localStorage.getItem('lastVisit') !== new Date().toDateString()) {
      generatePassage(true); // Show daily quote on first visit
      localStorage.setItem('lastVisit', new Date().toDateString());
    }

    // Helper functions (generateAudio, generateShareButtons, etc. remain similar but updated for new features)
    // ... (include all your existing helper functions with any necessary updates)
  </script>
</body>
</html>
