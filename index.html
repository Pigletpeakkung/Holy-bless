<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Holy Bless - Divine Wisdom Generator</title>
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gold-gradient: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
      --star-gradient: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Georgia', serif;
      background: var(--primary-gradient);
      min-height: 100vh;
      color: #333;
      transition: all 0.3s ease;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 300;
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .theme-selector, .source-filter {
      padding: 8px 15px;
      border: none;
      border-radius: 25px;
      background: rgba(255,255,255,0.2);
      color: white;
      backdrop-filter: blur(10px);
      cursor: pointer;
    }

    .star-button-container {
      text-align: center;
      margin: 40px 0;
    }

    .star-button {
      position: relative;
      width: 100px;
      height: 100px;
      background: var(--star-gradient);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
      transition: all 0.3s ease;
      transform: scale(1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5em;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .star-button:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.6);
      background: linear-gradient(135deg, #FFD700 0%, #FF8C00 100%);
    }

    .star-button:active {
      transform: scale(0.95) rotate(-5deg);
    }

    .star-button.active {
      animation: divineStarGlow 4s ease-in-out;
    }

    @keyframes divineStarGlow {
      0% { 
        box-shadow: 0 0 30px #FFD700, 0 0 60px #FFD700, 0 0 90px #FFD700;
        transform: scale(1.2) rotate(0deg);
      }
      25% { 
        box-shadow: 0 0 30px #FFA500, 0 0 60px #FFA500, 0 0 90px #FFA500;
        transform: scale(1.15) rotate(90deg);
      }
      50% { 
        box-shadow: 0 0 30px #FF6347, 0 0 60px #FF6347, 0 0 90px #FF6347;
        transform: scale(1.2) rotate(180deg);
      }
      75% { 
        box-shadow: 0 0 30px #FF4500, 0 0 60px #FF4500, 0 0 90px #FF4500;
        transform: scale(1.15) rotate(270deg);
      }
      100% { 
        box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        transform: scale(1) rotate(360deg);
      }
    }

    .star-icon {
      font-size: 1em;
      animation: twinkle 2s ease-in-out infinite alternate;
    }

    @keyframes twinkle {
      0% { opacity: 0.7; transform: scale(1); }
      100% { opacity: 1; transform: scale(1.1); }
    }

    .quote-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 40px;
      margin: 30px 0;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transform: translateY(20px);
      opacity: 0;
      transition: all 0.6s ease;
    }

    .quote-card.show {
      transform: translateY(0);
      opacity: 1;
    }

    .quote-text {
      font-size: 1.4em;
      line-height: 1.6;
      font-style: italic;
      color: #2c3e50;
      margin-bottom: 20px;
      text-align: center;
    }

    .quote-source {
      text-align: center;
      font-size: 1em;
      color: #7f8c8d;
      font-weight: 600;
      margin-bottom: 25px;
    }

    .quote-actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 25px;
    }

    .action-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .primary-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .primary-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }

    .secondary-btn {
      background: rgba(255, 255, 255, 0.8);
      color: #333;
      border: 2px solid rgba(102, 126, 234, 0.3);
    }

    .secondary-btn:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: rgba(102, 126, 234, 0.6);
    }

    .favorite-btn {
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
    }

    .favorite-btn.favorited {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
    }

    .daily-quote {
      background: var(--gold-gradient);
      color: white;
      padding: 30px;
      border-radius: 20px;
      margin: 30px 0;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .daily-quote h3 {
      font-size: 1.5em;
      margin-bottom: 15px;
      font-weight: 300;
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      color: white;
      min-width: 120px;
    }

    .stat-number {
      font-size: 2em;
      font-weight: bold;
      display: block;
    }

    .credit {
      font-size: 0.9em;
      color: rgba(255, 255, 255, 0.8);
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 15px;
    }

    /* TTS Status Indicator */
    .tts-status {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      font-size: 0.9em;
      z-index: 1000;
      display: none;
    }

    .tts-status.speaking {
      background: rgba(76, 175, 80, 0.9);
      display: block;
    }

    .tts-status.error {
      background: rgba(244, 67, 54, 0.9);
      display: block;
    }

    /* Theme variations */
    .theme-ocean {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .theme-sunset {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .theme-forest {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }

    .theme-cosmic {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 2em;
      }
      
      .quote-card {
        padding: 25px;
      }
      
      .quote-text {
        font-size: 1.2em;
      }
      
      .star-button {
        width: 80px;
        height: 80px;
        font-size: 2em;
      }
    }
  </style>
</head>
<body class="theme-ocean">
  <div class="container">
    <header class="header">
      <h1>✨ Holy Bless ✨</h1>
      <p>Sacred wisdom from the masters of consciousness</p>
    </header>

    <div class="controls">
      <select class="theme-selector" id="themeSelector">
        <option value="theme-ocean">Ocean Depths</option>
        <option value="theme-sunset">Sunset Glow</option>
        <option value="theme-forest">Forest Wisdom</option>
        <option value="theme-cosmic">Cosmic Mystery</option>
      </select>

      <select class="source-filter" id="sourceFilter">
        <option value="all">All Sources</option>
        <option value="Alan Watts">Alan Watts</option>
        <option value="Buddha">Buddha</option>
        <option value="Lao Tzu">Lao Tzu</option>
        <option value="Rumi">Rumi</option>
        <option value="Law of One">Law of One</option>
        <option value="Emerald Tablet">Emerald Tablet</option>
        <option value="Conversations with God">Conversations with God</option>
        <option value="Seth Speaks">Seth Speaks</option>
        <option value="Florence Scovel Shinn">Florence Scovel Shinn</option>
      </select>
    </div>

    <div class="daily-quote" id="dailyQuote">
      <h3>🌅 Today's Sacred Message</h3>
      <div id="dailyQuoteContent"></div>
    </div>

    <div class="stats">
      <div class="stat-item">
        <span class="stat-number" id="totalQuotes">0</span>
        <span>Total Wisdom</span>
      </div>
      <div class="stat-item">
        <span class="stat-number" id="quotesRead">0</span>
        <span>Messages Received</span>
      </div>
      <div class="stat-item">
        <span class="stat-number" id="favoriteCount">0</span>
        <span>Favorites Saved</span>
      </div>
    </div>

    <div class="star-button-container">
      <button id="starButton" class="star-button" onclick="generatePassage()" aria-label="Receive divine wisdom">
        <span class="star-icon">🌟</span>
      </button>
      <p style="color: white; margin-top: 15px; font-style: italic;">Click the sacred star to receive your message</p>
    </div>

    <div id="quoteCard" class="quote-card" style="display: none;">
      <div class="quote-text" id="quoteText"></div>
      <div class="quote-source" id="quoteSource"></div>
      <div class="quote-actions">
        <button class="action-btn primary-btn" id="playBtn">🔊 Listen</button>
        <button class="action-btn favorite-btn" id="favoriteBtn">❤️ Save</button>
        <button class="action-btn secondary-btn" id="shareBtn">📤 Share</button>
        <button class="action-btn secondary-btn" id="copyBtn">📋 Copy</button>
      </div>
    </div>

    <div class="credit">
      Sacred wisdom from: Conversations with God • Seth Speaks • Rumi • Alan Watts • Florence Scovel Shinn • Lao Tzu • Law of One • Emerald Tablet • Buddha • Gandhi • Einstein • Jung • Tesla • and the Quotable API
    </div>
  </div>

  <!-- TTS Status Indicator -->
  <div id="ttsStatus" class="tts-status"></div>

  <script>
    // Enhanced passages array with all quotes
    let passages = [
      // Conversations with God
      { text: "There is no such thing as 'wrong,' only what does not serve you. You cannot make a mistake, you can only make a choice.", id: 1, source: "Conversations with God" },
      { text: "The purpose of life is to know yourself, create yourself, and experience yourself as Who You Really Are.", id: 2, source: "Conversations with God" },
      { text: "Life is an ongoing process of creation. You are creating your reality with every thought, word, and action.", id: 3, source: "Conversations with God" },
      { text: "Fear is the opposite of love. Every thought, word, or deed is founded in one or the other.", id: 4, source: "Conversations with God" },
      { text: "You are not here to learn lessons; you are here to remember who you are.", id: 5, source: "Conversations with God" },
      { text: "The highest purpose of any soul is to be fully self-expressed in its divinity.", id: 6, source: "Conversations with God" },
      { text: "God is not a singular super-being, but the energy of life, and you are part of it.", id: 7, source: "Conversations with God" },

      // Seth Speaks
      { text: "You create your own reality. There are no limitations to the self except those you believe in.", id: 8, source: "Seth Speaks" },
      { text: "The universe is a multidimensional school, and you are here to learn and explore your own consciousness.", id: 9, source: "Seth Speaks" },
      { text: "Your beliefs form your experience, as surely as clay shapes a pot.", id: 10, source: "Seth Speaks" },
      { text: "There is no separation between you and All That Is; you are an eternal portion of it.", id: 11, source: "Seth Speaks" },
      { text: "The present is the point of power, where all realities intersect.", id: 12, source: "Seth Speaks" },
      { text: "Your inner self knows its purpose, and it guides you through every moment.", id: 13, source: "Seth Speaks" },
      { text: "Consciousness creates form, not the other way around.", id: 14, source: "Seth Speaks" },

      // Rumi
      { text: "Out beyond ideas of wrongdoing and rightdoing, there is a field. I'll meet you there.", id: 15, source: "Rumi" },
      { text: "The wound is the place where the Light enters you.", id: 16, source: "Rumi" },
      { text: "Do not feel lonely, the entire universe is inside you.", id: 17, source: "Rumi" },
      { text: "Let the beauty we love be what we do.", id: 18, source: "Rumi" },
      { text: "What you seek is seeking you.", id: 19, source: "Rumi" },
      { text: "Stop acting so small. You are the universe in ecstatic motion.", id: 20, source: "Rumi" },
      { text: "The heart has its own language; the heart knows a hundred thousand ways to speak.", id: 21, source: "Rumi" },

      // Alan Watts (Extended)
      { text: "You are the universe experiencing itself.", id: 22, source: "Alan Watts" },
      { text: "The only way to make sense out of change is to plunge into it, move with it, and join the dance.", id: 23, source: "Alan Watts" },
      { text: "Trying to define yourself is like trying to bite your own teeth.", id: 24, source: "Alan Watts" },
      { text: "The meaning of life is just to be alive. It is so plain and so obvious and so simple.", id: 25, source: "Alan Watts" },
      { text: "You don't look out there for God, something in the sky; you look in here.", id: 26, source: "Alan Watts" },
      { text: "Life is not a problem to be solved, but a reality to be experienced.", id: 27, source: "Alan Watts" },
      { text: "To have faith is to trust yourself to the water. You don't grab hold of it; you let it carry you.", id: 28, source: "Alan Watts" },
      { text: "The more a thing tends to be permanent, the more it tends to be lifeless.", id: 50, source: "Alan Watts" },
      { text: "We do not 'come into' this world; we come out of it, as leaves from a tree.", id: 51, source: "Alan Watts" },
      { text: "No one is more dangerously insane than one who is sane all the time.", id: 52, source: "Alan Watts" },
      { text: "Muddy water is best cleared by leaving it alone.", id: 53, source: "Alan Watts" },
      { text: "The ego is nothing other than the focus of conscious attention.", id: 54, source: "Alan Watts" },
      { text: "You are under no obligation to be the same person you were five minutes ago.", id: 55, source: "Alan Watts" },
      { text: "Problems that remain persistently insoluble should always be suspected as questions asked in the wrong way.", id: 56, source: "Alan Watts" },
      { text: "The art of living is neither careless drifting nor fearful clinging, but a dance.", id: 57, source: "Alan Watts" },
      { text: "What you are basically, deep deep down, is simply the fabric and structure of existence itself.", id: 58, source: "Alan Watts" },

      // Florence Scovel Shinn
      { text: "The game of life is a game of boomerangs. Our thoughts, deeds, and words return to us sooner or later with astounding accuracy.", id: 29, source: "Florence Scovel Shinn" },
      { text: "Every great work, every big accomplishment, has been brought into manifestation through holding to the vision.", id: 30, source: "Florence Scovel Shinn" },
      { text: "Your word is your wand. The words you speak create your own destiny.", id: 31, source: "Florence Scovel Shinn" },
      { text: "There is no loss in divine mind; therefore, I cannot lose anything that is rightfully mine.", id: 32, source: "Florence Scovel Shinn" },
      { text: "Faith is an active force, a power that moves mountains.", id: 33, source: "Florence Scovel Shinn" },
      { text: "The Divine Plan unfolds through your trust and inspired action.", id: 34, source: "Florence Scovel Shinn" },
      { text: "Intuition is the voice of God within, guiding you to your good.", id: 35, source: "Florence Scovel Shinn" },

      // Buddhist Teachings (Extended)
      { text: "Do not dwell in the past, do not dream of the future, concentrate the mind on the present moment.", id: 61, source: "Buddha" },
      { text: "Peace comes from within. Do not seek it without.", id: 62, source: "Buddha" },
      { text: "Holding onto anger is like drinking poison and expecting the other person to die.", id: 63, source: "Buddhist proverb" },
      { text: "Thousands of candles can be lit from a single candle, and the life of the candle will not be shortened.", id: 64, source: "Buddha" },
      { text: "You yourself, as much as anybody in the entire universe, deserve your love and affection.", id: 65, source: "Buddha" },
      { text: "In the end, only three things matter: how much you loved, how gently you lived, and how gracefully you let go.", id: 66, source: "Buddhist saying" },
      { text: "The root of suffering is attachment.", id: 67, source: "Buddha" },
      { text: "There is no path to happiness: happiness is the path.", id: 68, source: "Buddha" },
      { text: "All that we are is the result of what we have thought.", id: 69, source: "Buddha" },
      { text: "Better than a thousand hollow words is one word that brings peace.", id: 70, source: "Buddha" },
      { text: "Just as a snake sheds its skin, we must shed our past over and over again.", id: 71, source: "Buddha" },
      { text: "The mind is everything. What you think you become.", id: 72, source: "Buddha" },
      { text: "To understand everything is to forgive everything.", id: 73, source: "Buddha" },
      { text: "No one saves us but ourselves. No one can and no one may. We ourselves must walk the path.", id: 74, source: "Buddha" },
      { text: "Work out your own salvation. Do not depend on others.", id: 75, source: "Buddha" },

      // Tao Te Ching (Extended)
      { text: "The Tao that can be told is not the eternal Tao.", id: 76, source: "Lao Tzu, Tao Te Ching" },
      { text: "Nature does not hurry, yet everything is accomplished.", id: 77, source: "Lao Tzu, Tao Te Ching" },
      { text: "When I let go of what I am, I become what I might be.", id: 78, source: "Lao Tzu, Tao Te Ching" },
      { text: "A good traveler has no fixed plans and is not intent on arriving.", id: 79, source: "Lao Tzu, Tao Te Ching" },
      { text: "Knowing others is intelligence; knowing yourself is true wisdom.", id: 80, source: "Lao Tzu, Tao Te Ching" },
      { text: "The soft overcomes the hard; the gentle overcomes the rigid.", id: 81, source: "Lao Tzu, Tao Te Ching" },
      { text: "He who knows he has enough is rich.", id: 82, source: "Lao Tzu, Tao Te Ching" },
      { text: "The journey of a thousand miles begins with one step.", id: 83, source: "Lao Tzu, Tao Te Ching" },
      { text: "When you realize there is nothing lacking, the whole world belongs to you.", id: 84, source: "Lao Tzu, Tao Te Ching" },
      { text: "Silence is a source of great strength.", id: 85, source: "Lao Tzu, Tao Te Ching" },
      { text: "Be content with what you have; rejoice in the way things are.", id: 86, source: "Lao Tzu, Tao Te Ching" },
      { text: "To the mind that is still, the whole universe surrenders.", id: 87, source: "Lao Tzu, Tao Te Ching" },
      { text: "Health is the greatest possession. Contentment is the greatest treasure.", id: 88, source: "Lao Tzu, Tao Te Ching" },
      { text: "Respond intelligently even to unintelligent treatment.", id: 89, source: "Lao Tzu, Tao Te Ching" },
      { text: "New beginnings are often disguised as painful endings.", id: 90, source: "Lao Tzu, Tao Te Ching" },

      // Law of One (Extended)
      { text: "All is one. There is no polarity, no right or wrong, no disharmony, but only identity.", id: 91, source: "Law of One" },
      { text: "The universe is one being. When you harm another, you harm yourself.", id: 92, source: "Law of One" },
      { text: "Service to others is the path to unity with the Infinite.", id: 93, source: "Law of One" },
      { text: "The Creator is not separate from the creation; it is the creation.", id: 94, source: "Law of One" },
      { text: "Love is the vibration which creates, builds, and maintains all things.", id: 95, source: "Law of One" },
      { text: "The purpose of incarnation is to learn the ways of love.", id: 96, source: "Law of One" },
      { text: "There is no right or wrong. There is no polarity for all will be reconciled in time.", id: 97, source: "Law of One" },
      { text: "The heart of spiritual evolution is understanding that all beings are the Creator.", id: 98, source: "Law of One" },
      { text: "The path back to the One is through love, understanding and acceptance.", id: 99, source: "Law of One" },
      { text: "Each entity contains all of creation within its consciousness.", id: 100, source: "Law of One" },
      { text: "The present moment contains all that there is.", id: 101, source: "Law of One" },
      { text: "The greatest service is to be and to allow others to be.", id: 102, source: "Law of One" },
      { text: "All things, all of life, all of the creation is part of one original thought.", id: 103, source: "Law of One" },
      { text: "The purpose of the illusion is that the Creator may know Itself.", id: 104, source: "Law of One" },
      { text: "The energy of the Creator is love/light, light/love.", id: 105, source: "Law of One" },

      // Emerald Tablet (Extended)
      { text: "As above, so below; as below, so above.", id: 116, source: "Emerald Tablet" },
      { text: "That which is below is like that which is above, and that which is above is like that which is below, to accomplish the miracles of one thing.", id: 117, source: "Emerald Tablet" },
      { text: "The Sun is its father, the Moon its mother, the Wind carries it in its belly, the Earth is its nurse.", id: 118, source: "Emerald Tablet" },
      { text: "All things are born from this one thing by adaptation.", id: 119, source: "Emerald Tablet" },
      { text: "The universe is mental, held in the mind of the All.", id: 107, source: "Emerald Tablet" },
      { text: "Separate the earth from the fire, the subtle from the gross, gently and with great care.", id: 120, source: "Emerald Tablet" },
      { text: "Its power is complete when it is turned to earth.", id: 121, source: "Emerald Tablet" },

      // Additional Wisdom
      { text: "Be the change you wish to see in the world.", id: 108, source: "Mahatma Gandhi" },
      { text: "What we think, we become.", id: 109, source: "Mahatma Gandhi" },
      { text: "The only real valuable thing is intuition.", id: 110, source: "Albert Einstein" },
      { text: "Everything is energy and that's all there is to it.", id: 111, source: "Albert Einstein" },
      { text: "The privilege of a lifetime is to become who you truly are.", id: 112, source: "Carl Jung" },
      { text: "Your vision will become clear only when you can look into your own heart.", id: 113, source: "Carl Jung" },
      { text: "We are not human beings having a spiritual experience. We are spiritual beings having a human experience.", id: 114, source: "Pierre Teilhard de Chardin" },
      { text: "The day science begins to study non-physical phenomena, it will make more progress in one decade than in all the previous centuries.", id: 115, source: "Nikola Tesla" }
    ];

    // Enhanced state management
    let usedPassages = JSON.parse(localStorage.getItem('usedPassages')) || [];
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    let quotesRead = parseInt(localStorage.getItem('quotesRead')) || 0;
    let currentQuote = null;
    let isGenerating = false;
    let currentUtterance = null;

    // Enhanced TTS functionality with better error handling
    function initializeTTS() {
      console.log("Initializing TTS...");
      
      // Check if TTS is supported
      if (!('speechSynthesis' in window)) {
        showTTSStatus('TTS not supported in this browser', 'error');
        return false;
      }

      // Load voices
      const loadVoices = () => {
        const voices = window.speechSynthesis.getVoices();
        console.log(`Found ${voices.length} voices:`, voices.map(v => v.name));
        return voices.length > 0;
      };

      if (loadVoices()) {
        console.log("Voices already loaded");
        return true;
      }

      // Wait for voices to load
      window.speechSynthesis.onvoiceschanged = () => {
        console.log("Voices loaded");
        loadVoices();
      };

      return true;
    }

    // Enhanced audio generation with better voice selection
    function generateAudio(text, autoPlay = false) {
      console.log("Generating audio for:", text.substring(0, 50) + "...");
      
      // Cancel any existing speech
      if (currentUtterance) {
        window.speechSynthesis.cancel();
      }

      const utterance = new SpeechSynthesisUtterance(text);
      
      // Enhanced voice settings
      utterance.lang = 'en-US';
      utterance.pitch = 0.9;
      utterance.rate = 0.8;
      utterance.volume = 1.0;

      // Select best available voice
      const voices = window.speechSynthesis.getVoices();
      if (voices.length > 0) {
        // Prefer Google or Microsoft voices, then any English voice
        const preferredVoice = voices.find(voice => 
          voice.name.toLowerCase().includes('google') ||
          voice.name.toLowerCase().includes('microsoft') ||
          voice.name.toLowerCase().includes('natural') ||
          (voice.lang.startsWith('en') && voice.localService === false)
        ) || voices.find(voice => voice.lang.startsWith('en'));
        
        if (preferredVoice) {
          utterance.voice = preferredVoice;
          console.log("Using voice:", preferredVoice.name);
        }
      }

      // Enhanced event handlers
      utterance.onstart = () => {
        console.log("TTS started");
        showTTSStatus('🔊 Speaking...', 'speaking');
      };

      utterance.onend = () => {
        console.log("TTS ended");
        hideTTSStatus();
        currentUtterance = null;
      };

      utterance.onerror = (event) => {
        console.error("TTS error:", event.error);
        showTTSStatus(`TTS Error: ${event.error}`, 'error');
        currentUtterance = null;
      };

      utterance.onpause = () => {
        console.log("TTS paused");
        showTTSStatus('⏸️ Paused', 'speaking');
      };

      utterance.onresume = () => {
        console.log("TTS resumed");
        showTTSStatus('🔊 Speaking...', 'speaking');
      };

      currentUtterance = utterance;

      if (autoPlay) {
        // Small delay to ensure user interaction
        setTimeout(() => {
          try {
            window.speechSynthesis.speak(utterance);
            console.log("TTS playback started");
          } catch (error) {
            console.error("Failed to start TTS:", error);
            showTTSStatus('Failed to start speech', 'error');
          }
        }, 100);
      }

      return utterance;
    }

    // TTS Status indicator functions
    function showTTSStatus(message, type = 'speaking') {
      const statusEl = document.getElementById('ttsStatus');
      statusEl.textContent = message;
      statusEl.className = `tts-status ${type}`;
      
      if (type === 'error') {
        setTimeout(() => hideTTSStatus(), 3000);
      }
    }

    function hideTTSStatus() {
      const statusEl = document.getElementById('ttsStatus');
      statusEl.style.display = 'none';
      setTimeout(() => {
        statusEl.className = 'tts-status';
      }, 300);
    }

        // Daily quote functionality
    function getDailyQuote() {
      const today = new Date().toDateString();
      const stored = localStorage.getItem('dailyQuote');
      
      if (stored) {
        const dailyData = JSON.parse(stored);
        if (dailyData.date === today) {
          return dailyData.quote;
        }
      }
      
      // Generate new daily quote based on date seed for consistency
      const dateHash = today.split('').reduce((a, b) => {
        a = ((a << 5) - a) + b.charCodeAt(0);
        return a & a;
      }, 0);
      
      const index = Math.abs(dateHash) % passages.length;
      const dailyQuote = passages[index];
      
      localStorage.setItem('dailyQuote', JSON.stringify({
        date: today,
        quote: dailyQuote
      }));
      
      return dailyQuote;
    }

    // Display daily quote
    function displayDailyQuote() {
      const dailyQuote = getDailyQuote();
      document.getElementById('dailyQuoteContent').innerHTML = `
        <p style="font-style: italic; font-size: 1.1em; margin-bottom: 10px;">"${dailyQuote.text}"</p>
        <small>— ${dailyQuote.source}</small>
      `;
    }

    // Update statistics
    function updateStats() {
      document.getElementById('totalQuotes').textContent = passages.length;
      document.getElementById('quotesRead').textContent = quotesRead;
      document.getElementById('favoriteCount').textContent = favorites.length;
    }

    // Enhanced quote generation with filtering
    function generatePassage() {
      if (isGenerating) return;
      
      console.log("Generating passage...");
      isGenerating = true;

      const button = document.getElementById('starButton');
      button.classList.add('active');
      
      setTimeout(() => {
        button.classList.remove('active');
        isGenerating = false;
      }, 4000);

      // Get filtered passages
      const sourceFilter = document.getElementById('sourceFilter').value;
      let availablePassages = passages;
      
      if (sourceFilter !== 'all') {
        availablePassages = passages.filter(p => p.source.includes(sourceFilter));
        console.log(`Filtered to ${availablePassages.length} passages for: ${sourceFilter}`);
      }
      
      // Filter out used passages
      availablePassages = availablePassages.filter(p => !usedPassages.includes(p.id));

      if (availablePassages.length === 0) {
        console.log("Resetting used passages");
        usedPassages = [];
        availablePassages = sourceFilter === 'all' ? passages : passages.filter(p => p.source.includes(sourceFilter));
      }

      const randomPassage = availablePassages[Math.floor(Math.random() * availablePassages.length)];
      usedPassages.push(randomPassage.id);
      localStorage.setItem('usedPassages', JSON.stringify(usedPassages));
      
      // Update read count
      quotesRead++;
      localStorage.setItem('quotesRead', quotesRead.toString());
      
      currentQuote = randomPassage;
      console.log("Selected quote:", randomPassage);
      
      displayQuote(randomPassage);
      updateStats();
    }

    // Enhanced quote display
    function displayQuote(quote) {
      const quoteCard = document.getElementById('quoteCard');
      const quoteText = document.getElementById('quoteText');
      const quoteSource = document.getElementById('quoteSource');
      
      quoteText.textContent = `"${quote.text}"`;
      quoteSource.textContent = `— ${quote.source}`;
      
      quoteCard.style.display = 'block';
      setTimeout(() => {
        quoteCard.classList.add('show');
      }, 100);
      
      updateFavoriteButton();
      
      // Auto-play audio with enhanced error handling
      const utterance = generateAudio(quote.text, true);
      
      // Setup button handlers
      document.getElementById('playBtn').onclick = () => {
        console.log("Manual play button clicked");
        window.speechSynthesis.cancel();
        generateAudio(quote.text, true);
      };
      
      document.getElementById('favoriteBtn').onclick = () => toggleFavorite(quote);
      document.getElementById('shareBtn').onclick = () => shareQuote(quote);
      document.getElementById('copyBtn').onclick = () => copyQuote(quote);
    }

    // Favorites management
    function toggleFavorite(quote) {
      const existingIndex = favorites.findIndex(fav => fav.id === quote.id);
      
      if (existingIndex === -1) {
        favorites.push(quote);
        showNotification('Added to favorites! ❤️');
      } else {
        favorites.splice(existingIndex, 1);
        showNotification('Removed from favorites');
      }
      
      localStorage.setItem('favorites', JSON.stringify(favorites));
      updateFavoriteButton();
      updateStats();
    }

    function updateFavoriteButton() {
      const favoriteBtn = document.getElementById('favoriteBtn');
      if (currentQuote) {
        const isFavorited = favorites.some(fav => fav.id === currentQuote.id);
        favoriteBtn.textContent = isFavorited ? '💖 Saved' : '❤️ Save';
        favoriteBtn.classList.toggle('favorited', isFavorited);
      }
    }

    // Share functionality
    async function shareQuote(quote) {
      const shareData = {
        title: 'Holy Bless - Divine Wisdom',
        text: `"${quote.text}" — ${quote.source}`,
        url: window.location.href
      };

      if (navigator.share) {
        try {
          await navigator.share(shareData);
          showNotification('Shared successfully! ✨');
        } catch (err) {
          if (err.name !== 'AbortError') {
            fallbackShare(shareData);
          }
        }
      } else {
        fallbackShare(shareData);
      }
    }

    function fallbackShare(shareData) {
      const encodedText = encodeURIComponent(shareData.text);
      const platforms = [
        { name: 'Twitter', url: `https://twitter.com/intent/tweet?text=${encodedText}` },
        { name: 'Facebook', url: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareData.url)}&quote=${encodedText}` },
        { name: 'WhatsApp', url: `https://api.whatsapp.com/send?text=${encodedText}` }
      ];
      
      const platform = platforms[Math.floor(Math.random() * platforms.length)];
      window.open(platform.url, '_blank');
      showNotification(`Opening ${platform.name}...`);
    }

    // Copy to clipboard
    async function copyQuote(quote) {
      const text = `"${quote.text}" — ${quote.source}`;
      
      try {
        await navigator.clipboard.writeText(text);
        showNotification('Copied to clipboard! 📋');
      } catch (err) {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification('Copied to clipboard! 📋');
      }
    }

    // Enhanced notification system
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 15px 25px;
        border-radius: 25px;
        z-index: 1000;
        font-size: 0.9em;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        animation: slideInTop 0.3s ease;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOutTop 0.3s ease';
        setTimeout(() => {
          if (document.body.contains(notification)) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Theme management
    function setTheme(theme) {
      document.body.className = theme;
      localStorage.setItem('selectedTheme', theme);
    }

    // Keyboard navigation
    document.addEventListener('keydown', (event) => {
      if (event.key === ' ' && event.target === document.body) {
        event.preventDefault();
        generatePassage();
      }
      if (event.key === 'Escape') {
        if (currentUtterance) {
          window.speechSynthesis.cancel();
          hideTTSStatus();
        }
      }
    });

    // Event listeners
    document.getElementById('themeSelector').addEventListener('change', (e) => {
      setTheme(e.target.value);
    });

    document.getElementById('sourceFilter').addEventListener('change', () => {
      // Reset used passages when filter changes
      usedPassages = [];
      localStorage.setItem('usedPassages', JSON.stringify(usedPassages));
    });

    // Add CSS animations for notifications
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideInTop {
        from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
        to { transform: translateX(-50%) translateY(0); opacity: 1; }
      }
      
      @keyframes slideOutTop {
        from { transform: translateX(-50%) translateY(0); opacity: 1; }
        to { transform: translateX(-50%) translateY(-100%); opacity: 0; }
      }

      /* Enhanced star button animations */
      .star-button:hover .star-icon {
        animation: starPulse 0.6s ease-in-out infinite alternate;
      }

      @keyframes starPulse {
        0% { transform: scale(1) rotate(0deg); }
        100% { transform: scale(1.2) rotate(10deg); }
      }

      /* TTS status animations */
      .tts-status {
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    `;
    document.head.appendChild(style);

    // Enhanced initialization
    function initializeApp() {
      console.log("Initializing Holy Bless app...");
      
      // Initialize TTS
      const ttsReady = initializeTTS();
      if (ttsReady) {
        console.log("TTS initialized successfully");
      }
      
      // Load saved theme
      const savedTheme = localStorage.getItem('selectedTheme') || 'theme-ocean';
      document.getElementById('themeSelector').value = savedTheme;
      setTheme(savedTheme);
      
      // Display daily quote
      displayDailyQuote();
      
      // Update statistics
      updateStats();
      
      // Test TTS availability
      setTimeout(() => {
        const voices = window.speechSynthesis.getVoices();
        if (voices.length === 0) {
          console.warn("No TTS voices available");
          showTTSStatus('TTS voices loading...', 'speaking');
          setTimeout(() => hideTTSStatus(), 2000);
        } else {
          console.log(`TTS ready with ${voices.length} voices`);
        }
      }, 1000);
      
      // Show welcome message
      setTimeout(() => {
        showNotification('Welcome to Holy Bless! ✨ Click the star to receive wisdom.');
      }, 1500);

      // Add click event listener as backup
      document.getElementById('starButton').addEventListener('click', function(e) {
        e.preventDefault();
        console.log("Star button clicked via event listener");
        generatePassage();
      });
    }

    // Handle page visibility changes (helps with TTS on mobile)
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        // Page is hidden, pause TTS
        if (currentUtterance && window.speechSynthesis.speaking) {
          window.speechSynthesis.pause();
        }
      } else {
        // Page is visible, resume TTS
        if (currentUtterance && window.speechSynthesis.paused) {
          window.speechSynthesis.resume();
        }
      }
    });

    // Start the app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }

    // Debug function for testing TTS
    window.testTTS = function(text = "Testing text to speech functionality") {
      console.log("Testing TTS with:", text);
      generateAudio(text, true);
    };

    // Debug function for checking voices
    window.checkVoices = function() {
      const voices = window.speechSynthesis.getVoices();
      console.log("Available voices:", voices);
      voices.forEach((voice, index) => {
        console.log(`${index}: ${voice.name} (${voice.lang}) - ${voice.localService ? 'Local' : 'Remote'}`);
      });
      return voices;
    };
  </script>
</body>
</html>

